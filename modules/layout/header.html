<div header >
	<nav id=header__ID class="navbar navbar-default">
	  <div class="container">
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <a class="navbar-brand" onclick="load_module('who');">BUSINESS PORTAL</a>
	    </div>
	    <div class="collapse navbar-collapse" id="myNavbar" style='padding-right:100px'>
	      <ul class="nav navbar-nav navbar-right">
	        <li><a onclick="vm_nav_click_process('who');">WHO</a></li>
	        <li><a onclick="vm_nav_click_process('what');">WHAT</a></li>
	        <li><a onclick="vm_nav_click_process('where');">WHERE</a></li>
			<li><a onclick="vm_nav_click_process('portal');"><i class="fa fa-th"></i> PORTAL</a></li>
			<li><a name=signinout onclick="vm_nav_click_process('signinout')"></a></li>
	      </ul>
	    </div>
	  </div>
	</nav>
	<script navigation-processing>
		//-----------------------------------------
		var vm_nav_click_process=function(name){
			if( $(window).width()<786) $('.navbar-toggle').click();
			switch(name){
				case 'signinout':
					if($vm.user=='guest'){
						window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=600");
					}
					else{
						$VmAPI.clear_token();
						$VmAPI.request({data:{cmd:'signout'},callback:function(c){
							$vm.user="guest";
							$vm.user_id="";
							location.reload(true);
						}});
					}
					break;
				default:
					if(name=='dev'){
						$vm.alert('Under development');
					}
					else load_module(name);
					break;
			}
		}
		//-----------------------------------------
		var check_trust=function(url){
			var trust=0;
			if(url.indexOf('http://127.0.0.1')!=-1 || url.indexOf('http://localhost')!=-1){
				trust=1;
			}
			else{
				for(var i=0;i<$vm.trust_path.length;i++){
					var len=$vm.trust_path[i].length;
					if(url.indexOf($vm.trust_path[i])!==-1 && url.substring(0,len)==$vm.trust_path[i]){
						trust=1;
					}
				}
			}
			if(trust==0){
				alert("The url ("+url+") is not trusted.")
			}
			return trust;
		}
		//-----------------------------------------
		var load_module=function(name){
			if($vm.app_config.modules[name]!=undefined && $vm.app_config.modules[name].url!=undefined){
				if($vm.module_list[name]==undefined){
					$vm.module_list[name]=$vm.app_config.modules[name];
				}
			}
			var url=$vm.module_list[name].url;
			if(url.split('.').pop().split('?')[0]=='json'){
				load_panel(name)
				return;
			}
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			var single_record=$vm.module_list[name].single_record;
			if(check_trust(url)==0) return;
			var op={
				//-----------------
				sys:{
					config:$vm.app_config,
					UID:name,
				},
				//-----------------
			}
			var slot=$vm.root_layout_content_slot;
			if(single_record=='1') slot=undefined;
			$vm.load_module_by_name(name,slot,op)
		};
		//---------------------------------------------
		var load_panel=function(name){
			var url=$vm.module_list[name].url;
			if(url[0]=='/'){
				if($vm.hosting_path!=undefined) url=$vm.hosting_path+url;
			}
			if(check_trust(url)==0) return;
			console.log('loading '+url);
			$.get(url,function(text){
				var text=$('<div/>').html(text).text();
				//---------------------------
				var config;
				try{ config=JSON.parse(text); }
				catch (e){ alert("Error in config file\n"+e); return; }
				//-----------------------------------------------
				var module=name+"_panel";
				if($vm.module_list[module]==undefined){
					$vm.module_list[module]={
						url:config.url,
						var:{},
					}
				}
				$vm.load_module_by_name(module,$vm.root_layout_content_slot,{
					sys:{
						config:config,
						UID:name,
					}
				})
				//-----------------------------------------------
			},'text').fail(function() {
				alert( "The file '"+url+"' doesn't exist!" );
			});
		}
		//---------------------------------------------
		var show_sign=function(){
			if($vm.user=='guest'){
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN IN')
				$('#username__ID').text('');
			}
			else{
				$('a[name=signinout]').html('<i class="fa fa-user"></i> SIGN OUT')
				$('#username__ID').text('Signed in as '+ $vm.user);
			}
		}
		show_sign();
		//-----------------------------------------
	</script>
	<style>
		#header__ID a{
			cursor:pointer;
		}
		/*
		.navbar {
	        padding-top: 20px;
	        padding-bottom: 0px;
	        border: 0;
	        border-radius: 0;
	        margin-bottom: 0;
	        font-size: 12px;
	        letter-spacing: 5px;
	    }
	    .navbar-nav  li a:hover {
	        color: #1abc9c !important;
	    }
		*/
		#header__ID .navbar-brand{
			color:#FFF;
		}
		#header__ID ul.navbar-nav li a{
			color:#FFF;
		}
		#header__ID ul.navbar-nav li a:hover{
			color:#aaa;
		}
		.navbar {
			padding-top: 20px;
			margin-bottom: 0;
			background: #444;
			border: 0;
			-moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;
			-o-transition: all .6s; -moz-transition: all .6s; -webkit-transition: all .6s; -ms-transition: all .6s; transition: all .6s;
		}

		ul.navbar-nav {
			font-family: 'Josefin Sans', sans-serif;
			font-size: 14px;
			color: #fff;
			font-weight: 400;
			text-transform: uppercase;
		}

		.navbar-inverse ul.navbar-nav li a { padding-top: 20px; padding-bottom: 20px; color: #fff; border: 0; }
		.navbar-inverse ul.navbar-nav li a:hover { color: #ddd; border: 0; }
		.navbar-inverse ul.navbar-nav li a:focus { color: #ddd; outline: 0; border: 0; }

		.navbar-brand {
			height: 60px;
		}
		.navbar>.container .navbar-brand, .navbar>.container-fluid .navbar-brand { margin-left: 0; }
	</style>
</div>
